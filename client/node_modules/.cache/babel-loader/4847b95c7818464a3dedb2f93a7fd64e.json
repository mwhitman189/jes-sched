{"ast":null,"code":"import _objectSpread from \"/home/miles/webdev/jes-sched/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/home/miles/webdev/jes-sched/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport { useState } from \"react\";\nimport axios from \"axios\";\nimport moment from \"moment\";\nimport { getRecurrences } from \"../helperFunctions\";\nexport default (initialEvents => {\n  const _useState = useState(initialEvents),\n        _useState2 = _slicedToArray(_useState, 2),\n        events = _useState2[0],\n        setEvents = _useState2[1];\n\n  const JapaneseHolidays = require(\"japanese-holidays\");\n\n  return {\n    events,\n    getEvents: async date => {\n      return await axios.get(\"/lessons/\").then(res => {\n        if (res.data.length > 0) {\n          res.data.map(event => {\n            event.start = new Date(event.start);\n            event.end = new Date(event.end);\n          });\n\n          if (event.isLast) {\n            console.log(event.start.getDate());\n\n            if (event.start.getDate() === date) {\n              initialEvents.addEvent(event);\n            }\n          }\n\n          setEvents([...res.data, events[0]]);\n        }\n      }).catch(err => console.log(err));\n    },\n    addEvent: async eventItem => {\n      const newEvents = [];\n\n      if (eventItem.recur === true) {\n        const recurrences = getRecurrences(eventItem);\n        recurrences.map(r => {\n          const newEvent = _objectSpread({}, eventItem, {\n            start: r,\n            end: moment(r).add(event.duration, \"m\").toDate(),\n            isNewEvent: false\n          });\n\n          if (JapaneseHolidays.isHoliday(r)) {\n            newEvent.isHoliday = true;\n          }\n\n          newEvents.push(newEvent);\n          newEvents[newEvents.length - 1].isLast = true;\n        });\n      }\n\n      if (JapaneseHolidays.isHoliday(eventItem.start)) {\n        event = _objectSpread({}, eventItem, {\n          isHoliday: true\n        });\n      }\n\n      event = _objectSpread({}, eventItem, {\n        isNewEvent: true\n      });\n      newEvents.push(event);\n      console.log(newEvents);\n      return await axios.post(\"/lessons/add\", newEvents).then(res => console.log(res.data)).catch(err => console.log(err));\n    },\n    deleteEvent: async eventItem => {\n      const newEvents = events.filter(evt => evt._id !== eventItem._id);\n      setEvents(newEvents);\n      return await axios.delete(`/lessons/delete/${eventItem._id}`).then(res => console.log(res.data)).catch(err => console.log(err));\n    },\n    editEvent: async (event, editedEvent) => {\n      const idx = events.findIndex(e => e._id === event._id);\n      const nextEvents = [...events];\n      nextEvents.splice(idx, 1, editedEvent);\n      setEvents(nextEvents);\n      return await axios.put(`/lessons/update/${event._id}`, editedEvent).then(res => console.log(res.data)).catch(err => console.log(err));\n    }\n  };\n});","map":{"version":3,"sources":["/home/miles/webdev/jes-sched/client/src/hooks/useEventsState.js"],"names":["useState","axios","moment","getRecurrences","initialEvents","events","setEvents","JapaneseHolidays","require","getEvents","date","get","then","res","data","length","map","event","start","Date","end","isLast","console","log","getDate","addEvent","catch","err","eventItem","newEvents","recur","recurrences","r","newEvent","add","duration","toDate","isNewEvent","isHoliday","push","post","deleteEvent","filter","evt","_id","delete","editEvent","editedEvent","idx","findIndex","e","nextEvents","splice","put"],"mappings":"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","sourcesContent":["import { useState } from \"react\";\nimport axios from \"axios\";\nimport moment from \"moment\";\nimport { getRecurrences } from \"../helperFunctions\";\n\nexport default initialEvents => {\n  const [events, setEvents] = useState(initialEvents);\n  const JapaneseHolidays = require(\"japanese-holidays\");\n\n  return {\n    events,\n    getEvents: async date => {\n      return await axios\n        .get(\"/lessons/\")\n        .then(res => {\n          if (res.data.length > 0) {\n            res.data.map(event => {\n              event.start = new Date(event.start);\n              event.end = new Date(event.end);\n            });\n            if (event.isLast) {\n              console.log(event.start.getDate());\n              if (event.start.getDate() === date) {\n                initialEvents.addEvent(event);\n              }\n            }\n            setEvents([...res.data, events[0]]);\n          }\n        })\n        .catch(err => console.log(err));\n    },\n    addEvent: async eventItem => {\n      const newEvents = [];\n      if (eventItem.recur === true) {\n        const recurrences = getRecurrences(eventItem);\n        recurrences.map(r => {\n          const newEvent = {\n            ...eventItem,\n            start: r,\n            end: moment(r)\n              .add(event.duration, \"m\")\n              .toDate(),\n            isNewEvent: false\n          };\n          if (JapaneseHolidays.isHoliday(r)) {\n            newEvent.isHoliday = true;\n          }\n          newEvents.push(newEvent);\n          newEvents[newEvents.length - 1].isLast = true;\n        });\n      }\n      if (JapaneseHolidays.isHoliday(eventItem.start)) {\n        event = { ...eventItem, isHoliday: true };\n      }\n      event = { ...eventItem, isNewEvent: true };\n      newEvents.push(event);\n      console.log(newEvents);\n      return await axios\n        .post(\"/lessons/add\", newEvents)\n        .then(res => console.log(res.data))\n        .catch(err => console.log(err));\n    },\n    deleteEvent: async eventItem => {\n      const newEvents = events.filter(evt => evt._id !== eventItem._id);\n      setEvents(newEvents);\n      return await axios\n        .delete(`/lessons/delete/${eventItem._id}`)\n        .then(res => console.log(res.data))\n        .catch(err => console.log(err));\n    },\n    editEvent: async (event, editedEvent) => {\n      const idx = events.findIndex(e => e._id === event._id);\n      const nextEvents = [...events];\n\n      nextEvents.splice(idx, 1, editedEvent);\n      setEvents(nextEvents);\n\n      return await axios\n        .put(`/lessons/update/${event._id}`, editedEvent)\n        .then(res => console.log(res.data))\n        .catch(err => console.log(err));\n    }\n  };\n};\n"]},"metadata":{},"sourceType":"module"}